#! /bin/bash
#SBATCH -J filter2
#SBATCH -D /scratch/shulinhe/phylogeny
#SBATCH -o filter.%j.out
#SBATCH --nodes=1-1
#SBATCH --ntasks=6
#SBATCH --mem=10000
#SBATCH --time=2:00:00
#SBATCH --mail-type=all
#SBATCH --mail-user=shulinhe@zedat.fu-berlin.de
for j in {"SRA_Pa2015","SRA_Pa2016"}; do cd trinity_"$j"_as/; ~/opt/trinityrnaseq-Trinity-v2.5.1/util/align_and_estimate_abundance.pl --transcript Trinity.fasta --est_method kallisto --trinity_mode --prep_reference --output_dir ./; ~/opt/trinityrnaseq-Trinity-v2.5.1/util/align_and_estimate_abundance.pl --transcript Trinity.fasta --seqType fq --left ../"$j"_1_trim_1.gz --right ../"$j"_1_trim_2.gz --est_method kallisto --trinity_mode --output_dir ./"$j"_1;~/opt/trinityrnaseq-Trinity-v2.5.1/util/align_and_estimate_abundance.pl --transcript Trinity.fasta --seqType fq --left ../"$j"_2_trim_1.gz --right ../"$j"_2_trim_2.gz --est_method kallisto --trinity_mode --output_dir ./"$j"_2;~/opt/trinityrnaseq-Trinity-v2.5.1/util/abundance_estimates_to_matrix.pl --est_method kallisto --gene_trans_map Trinity.fasta.gene_trans_map --name_sample_by_basedir ./"$j"_1/abundance.tsv ./"$j"_2/abundance.tsv; ~/opt/trinityrnaseq-Trinity-v2.5.1/util/filter_low_expr_transcripts.pl -m kallisto.isoform.TMM.EXPR.matrix -t Trinity.fasta --highest_iso_only --trinity_mode > "$j"_Trinity_fil.fasta; cd ../; done

